<html>
<head>
<title>PTC | Archived Projects</title>
</head>
<body>

<?php include("ptc.php"); ?>

<?php
##echo " python sucks. converting to php. -jcran </br> </br>";

//////////////////////////////////////////////////////////////////
// First, fill in $files_directory to the directory of files /////
//////////////////////////////////////////////////////////////////
$files_directory = "/var/svn-archive";

//////////////////////////////////////////////////////////////////
// Define our arrays /////////////////////////////////////////////
//////////////////////////////////////////////////////////////////
$new_array = array();
$files = array();

//////////////////////////////////////////////////////////////////
// Open the directory of files and fill array ////////////////////
//////////////////////////////////////////////////////////////////
$fdirectory = opendir( "$files_directory" );
while ($file = readdir( $fdirectory ) ) {
if ( ( $file == "." ) || ( $file == ".." ) || ( $file == ".htaccess" ) ) {
    } else {
    array_push( $files, $file );
    }
}

//stat to get dates
foreach ( $files as $key=> $file ) {
$c_date = filemtime("$files_directory/$file/db/current");
$new_array[$c_date] = $file;
}

//sort by keys, not values
krsort( $new_array );

// set up the table header
echo "<table border\"1\">";
echo "<tr>";
echo "<td>";
echo "project";
echo "</td>";
echo "<td>";
echo "last modified";
echo "</td>";
echo "<td>";
echo "unarchive";
echo "</td>";
echo "</tr>";

// echo through the array, displaying each project
while ( $this_array = each( $new_array ) ){
$value = $this_array['value'];
$key = $this_array['key'];
$key_convert = date("M j Y, h:ia", $key);
echo "<tr>";
echo "<td>";
echo $value;
echo "</td>";
echo "<td>";
echo $key_convert;
echo "</td>";
echo "<td>";
echo "<a href=\"http://" . $_SERVER["SERVER_NAME"] ."/unarchive2.php?project=" . $value . "\"> unarchive </a>";
echo "</td>";	
echo "</tr>";
}

echo "</table>";

// clear cache - necessary?
clearstatcache();

?>
</body>
</html>

