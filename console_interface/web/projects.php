<html>
<head>
<title> PTC | Projects </title>
</head>
<body>

<?php include("ptc.php"); ?>

<?php

##echo " python sucks. converting to php. -jcran </br> </br>";

//////////////////////////////////////////////////////////////////
// First, fill in $files_directory to the directory of files /////
//////////////////////////////////////////////////////////////////
$files_directory = "/var/trac";

//////////////////////////////////////////////////////////////////
// Define our arrays /////////////////////////////////////////////
//////////////////////////////////////////////////////////////////
$new_array = array();
$files = array();

//////////////////////////////////////////////////////////////////
// Open the directory of files and fill array ////////////////////
//////////////////////////////////////////////////////////////////
$fdirectory = opendir( "$files_directory" );
while ($file = readdir( $fdirectory ) ) {
if ( ( $file == "." ) || ( $file == ".." ) || ($file == ".egg-cache") || ( $file == ".htaccess" ) ) {
    } else {
    array_push( $files, $file );
    }
}

//stat to get dates
foreach ( $files as $key=> $file ) {
$c_date = filemtime("$files_directory/$file/db/trac.db");
$new_array[$c_date] = $file;
}

//sort by keys, not values
krsort( $new_array );

// set up the table header
echo "<table border\"1\">";
echo "<tr>";
echo "<td>";
echo "project";
echo "</td>";
echo "<td>";
echo "last modified";
echo "</td>";
echo "<td>";
echo "feed";
echo "</td>";
echo "<td>";
echo "copy";
echo "</td>";
echo "<td>";
echo "archive";
echo "</td>";
echo "<td>";
echo "rename";
echo "</td>";
echo "<td>";
echo "export";
echo "</td>";
echo "<td>";
echo "delete";
echo "</td>";
echo "<td>";
echo "last update";
echo "</td>";
echo "</tr>";

// echo through the array, displaying each project
while ( $this_array = each( $new_array ) ){
$value = $this_array['value'];
$key = $this_array['key'];
$key_convert = date("M j Y, h:ia", $key);
echo "<tr>";
echo "<td>";
echo "<a href=\"http://" . $_SERVER["SERVER_NAME"] . "/projects/" . $value . "\">" . $value . "</a>";
echo "</td>";
echo "<td>";
echo $key_convert;
echo "</td>";
echo "<td>";
echo "<a href=\"http://" . $_SERVER["SERVER_NAME"] . "/projects/" . $value . "/timeline?templates=on&milestone=on&ticket=on&changeset=on&wiki=on&max=500&daysback=900&format=rss\"> <img border=0 src=\"img/rss_icon.jpg\"> </a>";
echo "</td>";
echo "<td>";
echo "<a href=\"http://" . $_SERVER["SERVER_NAME"] ."/copy2.php?old=" . $value . "\"> copy </a>";
echo "</td>";
echo "<td>";
echo "<a href=\"http://" . $_SERVER["SERVER_NAME"] ."/archive2.php?project=" . $value . "\"> archive </a>";
echo "</td>";
echo "<td>";
echo "<a href=\"http://" . $_SERVER["SERVER_NAME"] ."/rename2.php?old=" . $value . "\"> rename </a>";
echo "</td>";
echo "<td>";
echo "export";
echo "</td>";
echo "<td>";
echo "<a href=\"http://" . $_SERVER["SERVER_NAME"] ."/delete2.php?project=" . $value . "\"> delete </a>";
echo "</td>";
echo "<td>";
echo "coming soon";
echo "</td>";
	
echo "</tr>";
}

echo "</table>";

// clear cache - necessary?
clearstatcache();

?>
</body>
</html>

