#!/bin/bash

if [ $# -ne 2 ]; then 
 echo "usage: $0 [old] [new] - renames a ptc project"
 exit -1
fi

##
## TODO! this needs to be santized
## TODO! rewrite to check the second dir -think about the eeeepppppileppttic doggggs. lol

if [ $1 ]; then  #make sure it's not null 

   echo "non-null project (good)"

   if [ -d /var/trac/$1 ]; then  #make sure it's a directory
      echo moving trac directory...
      mv /var/trac/$1 /var/trac/$2
   else 
      echo "no trac?"
      exit
   fi

   if [ -d /var/svn/$1 ]; then  #make sure it's a directory
      echo deleting svn directory...
      mv /var/svn/$1 /var/svn/$2
   else 
      echo "no svn?"
      exit
   fi

else 
   echo "are you sure that exists? check again"
   exit
fi

# Set configuration - replace project specifics in the configuration files for this project
echo "modding trac.ini"
cp /var/trac/$2/conf/trac.ini /var/trac/$2/conf/trac.ini.temp
sed -e "s/$1/$2/g" /var/trac/$2/conf/trac.ini.temp > /var/trac/$2/conf/trac.ini
rm /var/trac/$2/conf/trac.ini.temp

## set perms - shouldn't be necessary if we're running as PTC user... -- need to make sure primary group is set properly, then things are all good. 
##sudo chown www-data:users /var/trac/$2 -R
##sudo chown www-data:users /var/svn/$2 -R

## resync, now that we've changed the repo directory (modding trac.ini)
trac-admin /var/trac/$2 resync

