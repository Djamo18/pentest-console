#!/bin/bash
##
## Maintainer: jcran
## Description: dumps a trac wiki's projects after completion
## TODO: have this bad boy re-written in perl, read a file
##       for regex expressions & filter out anything matching those patterns

source /usr/local/share/bashdb/bashdb-trace

if [ ! $# -eq 3 ]; then
  echo "Usage: dumpProject.sh [oldProjectName] [newProjectName] [RegEx for pages]"
  exit
fi

echo "old project: $1"
echo "new project: $2"

if [ -e wikiTemp ]; then
  rm -rf wikiTemp
fi

mkdir wikiTemp
trac-admin /var/trac/$1 wiki dump wikiTemp

if [ -e wikiTemp2 ]; then 
  rm -rf wikiTemp2
fi

mkdir wikiTemp2 
for filename in `ls wikiTemp`
do
if [ -e "`echo $filename | awk '/ $3 /'`" ]; then 
	cp `echo $filename | awk '/ $3 /'` wikiTemp2
fi
done
