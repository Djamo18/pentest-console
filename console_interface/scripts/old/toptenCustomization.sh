#!/bin/bash
###
#
# pentestCustomization.sh 
#
###
#
# Owner: 	jabra
#		jcran
#
# Purpose: 	Do Trac-specific customization for a OWASP Top 10 Assessment
#
# Description: 
#		- Add top10 Milestones
#		- Add top10 Tickets
#		- Set Ticket Resolutions (not implemented)
#		- Load top10 Wiki Template
#
# History:
#		03/15/08 - Created from start_engagement.sh

#Get Arguments
CLIENT=$1
if [ $0 == "sudo" ] ; then
        CLIENT=$2
fi

#echo $CLIENT

#Sanitize Client Name
CLIENT=`echo $CLIENT |perl -p -e 's/\W//g'`

if [ -z $CLIENT  ] ; then
        echo "Client is blank"
        exit 1
fi

RDIR=/var/www/scripts

trac-admin /var/trac/$CLIENT milestone add "Visceral Examination"
trac-admin /var/trac/$CLIENT milestone add "OWASP Top Ten"
trac-admin /var/trac/$CLIENT milestone add "Reporting"
 
#ticket add <summary> <milestone> <component> description_file

trac-admin /var/trac/$CLIENT ticket add "Visceral Examination" "Visceral Examination" component1
trac-admin /var/trac/$CLIENT ticket add "A1 - Cross-Site Scripting" "OWASP Top Ten" component1
trac-admin /var/trac/$CLIENT ticket add "A2 - Injection Flaws" "OWASP Top Ten" component1
trac-admin /var/trac/$CLIENT ticket add "A3 - Malicious File Execution" "OWASP Top Ten" component1
trac-admin /var/trac/$CLIENT ticket add "A4 - Insecure Direct Object Reference" "OWASP Top Ten" component1
trac-admin /var/trac/$CLIENT ticket add "A5 - Cross-Site Request Forgery" "OWASP Top Ten" component1
trac-admin /var/trac/$CLIENT ticket add "A6 - Information Leakage and Improper Error Handling" "OWASP Top Ten" component1 
trac-admin /var/trac/$CLIENT ticket add "A7 - Broken Authentication and Session Management" "OWASP Top Ten" component1
trac-admin /var/trac/$CLIENT ticket add "A8 - Insecure Cryptographic Storage" "OWASP Top Ten" component1
trac-admin /var/trac/$CLIENT ticket add "A9 - Insecure Communications" "OWASP Top Ten" component1
trac-admin /var/trac/$CLIENT ticket add "A10 - Failure To Restrict URL Access" "OWASP Top Ten" component1
trac-admin /var/trac/$CLIENT ticket add "Reporting"  "Reporting" component1

# set ticket resolution messages
# Requires Trac 0.11
## leaves invalid, and duplicate
#trac-admin /var/trac/$CLIENT resolution remove fixed
#trac-admin /var/trac/$CLIENT resolution remove wontfix
#trac-admin /var/trac/$CLIENT resolution remove worksforme
#trac-admin /var/trac/$CLIENT resolution add vulnfound
#trac-admin /var/trac/$CLIENT resolution add novulnfound
#trac-admin /var/trac/$CLIENT resolution add taskdone
#trac-admin /var/trac/$CLIENT resolution add taskskipped

# this is for the start page for jcran..
rm  $RDIR/topten/wiki/*
trac-admin /var/trac/TEMPLATEtopten wiki dump $RDIR/topten/wiki/
trac-admin /var/trac/$CLIENT wiki load $RDIR/topten/wiki

## Repo Customization (05/08/08)
#Create directories needed
mkdir -p /tmp   #should fail (already exists)
mkdir -p /tmp/$CLIENT/ #should fail (already exists)

cd /tmp/$CLIENT/
svn co file:///var/svn/$CLIENT/ svn
cd svn/trunk
svn export file:///var/svn/TEMPLATEtopten/
mv -f TEMPLATEtopten/trunk/* .
rm -Rf TEMPLATEtopten
svn add *
svn ci -m "template topten checkin" *

