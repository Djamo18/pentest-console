#!/bin/bash
###
#
# $RDIR/pentestCustomization.sh 
#
###
#
# Owner: 	jcran / jabra
#
# Purpose: 	Do Trac-specific customization for a $RDIR/pentest
#
# Description: 
#		- Add Pentest Milestones
#		- Add Pentest Tickets
#		- Set Ticket Resolutions (not implemented)
#		- Load Pentest Wiki Template
#		- Removed template milestones (XMLRPC script)
#		- Removed template tickets (XMLRPC script)
#		- Genericised for all TEMPLATE Projects

#Get Arguments
CLIENT=$1
PROJECT=$2

if [ $0 == "sudo" ] ; then
        CLIENT=$2
	PROJECT=$3
fi

#Sanitize Client Name
CLEANCLIENT=${CLIENT//[^a-zA-Z0-9]/}
CLEANPROJECT=${PROJECT//[^a-zA-Z0-9]/}

if [ -z $CLEANCLIENT  ] ; then
        echo "Client is blank"
        exit 1
fi

#Create directories needed
mkdir -p /tmp   #should fail (already exists)
mkdir -p /tmp/$CLEANCLIENT/

#Pull down new project, export template into it, check it in
cd /tmp/$CLEANCLIENT/
svn co file:///var/svn/$CLEANCLIENT/ /tmp/$CLEANCLIENT/svn
cd svn
svn export file:///var/svn/$CLEANPROJECT .
svn add * 
svn ci -m "intial checkin" *

# Wiki Customization
mkdir -p /tmp/$CLEANCLIENT/wiki
rm  /tmp/$CLEANCLIENT/wiki/*
trac-admin /var/trac/$CLEANPROJECT wiki dump /tmp/$CLEANCLIENT/wiki
trac-admin /var/trac/$CLEANCLIENT wiki load /tmp/$CLEANCLIENT/wiki

## Cleanup 
cd
rm -rf /tmp/$CLEANCLIENT
