#!/bin/bash
###
#
# $RDIR/internalPentestCustomization.sh 
#
###
#
# Owner: 	jabra
#		jcran
#
# Purpose: 	Do Trac-specific customization for an internal pentest
#
# Description: 
#		- Add Pentest Milestones
#		- Add Pentest Tickets
#		- Set Ticket Resolutions (not implemented)
#		- Load Pentest Wiki Template
#
# History:
#		03/15/08 - Created from start_engagement.sh

#Get Arguments
CLIENT=$1
if [ $0 == "sudo" ] ; then
        CLIENT=$2
fi

#echo $CLIENT

#Sanitize Client Name
CLIENT=`echo $CLIENT |perl -p -e 's/\W//g'`

if [ -z $CLIENT  ] ; then
        echo "Client is blank"
        exit 1
fi

RDIR=/var/www/scripts

# add milestones

trac-admin /var/trac/$CLIENT milestone add "Project Setup"
trac-admin /var/trac/$CLIENT milestone add "Recon"
trac-admin /var/trac/$CLIENT milestone add "Scanning"
trac-admin /var/trac/$CLIENT milestone add "Attack"
trac-admin /var/trac/$CLIENT milestone add "Reporting"
trac-admin /var/trac/$CLIENT milestone add "Project Teardown"
# add tickets


## Project Setup Tix
trac-admin /var/trac/$CLIENT ticket add "Kickoff Call" "Project Setup" component1 $RDIR/internalPentest/tickets/blank.txt
trac-admin /var/trac/$CLIENT ticket add "Project Scheduled" "Project Setup" component1 $RDIR/internalPentest/tickets/blank.txt
trac-admin /var/trac/$CLIENT ticket add "Project Plan Completed" "Project Setup" component1 $RDIR/internalPentest/tickets/blank.txt
trac-admin /var/trac/$CLIENT ticket add "Project Plan Sent and Confirmed" "Project Setup" component1 $RDIR/internalPentest/tickets/blank.txt

## Recon Tix
trac-admin /var/trac/$CLIENT ticket add "Physical Recon" "Recon" component1 $RDIR/internalPentest/tickets/blank.txt
trac-admin /var/trac/$CLIENT ticket add "Network Recon" "Recon" component1 $RDIR/internalPentest/tickets/blank.txt
trac-admin /var/trac/$CLIENT ticket add "Wireless Recon" "Recon" component1 $RDIR/internalPentest/tickets/blank.txt

## Scanning Tix
trac-admin /var/trac/$CLIENT ticket add "Perform NeXpose Scan" "Scanning" component1 $RDIR/internalPentest/tickets/nexpose.txt

## Attack Tix
trac-admin /var/trac/$CLIENT ticket add "Bruteforce Services" "Attack" component1 $RDIR/internalPentest/tickets/brute_ssh.txt
trac-admin /var/trac/$CLIENT ticket add "Locate and Attack Web Applications" "Attack" component1 $RDIR/internalPentest/tickets/webapps.txt

## Reporting Tix

trac-admin /var/trac/$CLIENT ticket add "Prepare Template Report" "Reporting" component1 $RDIR/internalPentest/tickets/blank.txt
trac-admin /var/trac/$CLIENT ticket add "Write Executive Summary" "Reporting" component1 $RDIR/internalPentest/tickets/blank.txt
trac-admin /var/trac/$CLIENT ticket add "Write Attack Summary" "Reporting" component1 $RDIR/internalPentest/tickets/blank.txt
trac-admin /var/trac/$CLIENT ticket add "Prepare Report Portal" "Reporting" component1 $RDIR/internalPentest/tickets/blank.txt
trac-admin /var/trac/$CLIENT ticket add "Prepare Supporting Documentation" "Reporting" component1 $RDIR/internalPentest/tickets/blank.txt

## Teardown Tix
trac-admin /var/trac/$CLIENT ticket add "Debriefing Call Scheduled" "Project Teardown" component1 $RDIR/internalPentest/tickets/blank.txt 
trac-admin /var/trac/$CLIENT ticket add "Debriefing Call Completed" "Project Teardown" component1 $RDIR/internalPentest/tickets/blank.txt 
trac-admin /var/trac/$CLIENT ticket add "Debriefing Call Scheduled" "Project Teardown" component1 $RDIR/internalPentest/tickets/blank.txt 


# set ticket resolution messages
# Requires Trac 0.11
## leaves invalid, and duplicate
#trac-admin /var/trac/$CLIENT resolution remove fixed
#trac-admin /var/trac/$CLIENT resolution remove wontfix
#trac-admin /var/trac/$CLIENT resolution remove worksforme
#trac-admin /var/trac/$CLIENT resolution add findingconfirmed
#trac-admin /var/trac/$CLIENT resolution add taskcompleted
#trac-admin /var/trac/$CLIENT resolution add taskskipped

# Wiki Customization
# this is for the start page for jcran..
rm  $RDIR/internalPentest/wiki/*
trac-admin /var/trac/TEMPLATEinternalPentest wiki dump $RDIR/internalPentest/wiki/
trac-admin /var/trac/$CLIENT wiki load $RDIR/internalPentest/wiki

## Repo Customization (05/08/08)
#Create directories needed

mkdir -p /tmp   #should fail (already exists)
mkdir -p /tmp/$CLIENT/ #should fail (already exists)

cd /tmp/$CLIENT/
svn co file:///var/svn/$CLIENT/ svn
cd svn/trunk
svn export file:///var/svn/TEMPLATEinternalPentest/
mv -f TEMPLATEinternalPentest/trunk/* .
rm -Rf TEMPLATEinternalPentest
svn add * 
svn ci -m "initial template internal pentest checkin" *

rm -rf /tmp/$CLIENT/
