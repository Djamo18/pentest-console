#!/bin/bash
###
#
# $RDIR/pentestCustomization.sh 
#
###
#
# Owner: 	jabra
#		jcran
#
# Purpose: 	Do Trac-specific customization for a $RDIR/pentest
#
# Description: 
#		- Add Pentest Milestones
#		- Add Pentest Tickets
#		- Set Ticket Resolutions (not implemented)
#		- Load Pentest Wiki Template
#
# History:
#		03/15/08 - Created from start_engagement.sh

#Get Arguments
CLIENT=$1
if [ $0 == "sudo" ] ; then
        CLIENT=$2
fi

#echo $CLIENT

#Sanitize Client Name
CLIENT=`echo $CLIENT |perl -p -e 's/\W//g'`

if [ -z $CLIENT  ] ; then
        echo "Client is blank"
        exit 1
fi

RDIR=/var/www/scripts

# add milestones

trac-admin /var/trac/$CLIENT milestone add "Project Setup"
trac-admin /var/trac/$CLIENT milestone add "Recon"
trac-admin /var/trac/$CLIENT milestone add "Scanning"
trac-admin /var/trac/$CLIENT milestone add "Attack"
trac-admin /var/trac/$CLIENT milestone add "Reporting"
trac-admin /var/trac/$CLIENT milestone add "Project Teardown"
# add tickets


## Project Setup Tix
trac-admin /var/trac/$CLIENT ticket add "Scoping Completed" "Project Setup" component1 $RDIR/pentest/tickets/blank.txt
trac-admin /var/trac/$CLIENT ticket add "Project Scheduled" "Project Setup" component1 $RDIR/pentest/tickets/blank.txt
trac-admin /var/trac/$CLIENT ticket add "Project Plan Completed" "Project Setup" component1 $RDIR/pentest/tickets/blank.txt
trac-admin /var/trac/$CLIENT ticket add "Project Plan Sent and Confirmed" "Project Setup" component1 $RDIR/pentest/tickets/blank.txt

## Recon Tix
trac-admin /var/trac/$CLIENT ticket add "Perform Organizational Recon" "Recon" component1 $RDIR/pentest/tickets/blank.txt
trac-admin /var/trac/$CLIENT ticket add "Perform Domain Recon" "Recon" component1 $RDIR/pentest/tickets/blank.txt
trac-admin /var/trac/$CLIENT ticket add "Perform Network Recon" "Recon" component1 $RDIR/pentest/tickets/blank.txt
trac-admin /var/trac/$CLIENT ticket add "Perform Web Recon" "Recon" component1 $RDIR/pentest/tickets/blank.txt
trac-admin /var/trac/$CLIENT ticket add "Perform User Recon" "Recon" component1 $RDIR/pentest/tickets/blank.txt

## Scanning Tix
trac-admin /var/trac/$CLIENT ticket add "Perform Nmap Scan" "Scanning"  component1 $RDIR/pentest/tickets/nmap.txt
trac-admin /var/trac/$CLIENT ticket add "Perform Nikto Scan" "Scanning" component1 $RDIR/pentest/tickets/nikto.txt
trac-admin /var/trac/$CLIENT ticket add "Perform Nessus Scan" "Scanning" component1 $RDIR/pentest/tickets/nessus.txt
trac-admin /var/trac/$CLIENT ticket add "Perform NeXpose Scan" "Scanning" component1 $RDIR/pentest/tickets/nexpose.txt

## Scan Analysis
trac-admin /var/trac/$CLIENT ticket add "Create Tickets from NeXpose Scan Results" "Scan Analysis" component1 $RDIR/pentest/tickets/blank.txt
trac-admin /var/trac/$CLIENT ticket add "Generate NeXpose XML Export Report" "Scan Analysis"  component1 $RDIR/pentest/tickets/nexpose_report.txt

  ## Hasn't been built yet
  ##trac-admin /var/trac/$CLIENT ticket add "Parse NeXpose XML Export to Generate Tickets" "Scan Analysis" $RDIR/pentest/tickets/blank.txt 

trac-admin /var/trac/$CLIENT ticket add "Parse NeXpose XML Export to Generate Wiki Pages" "Scan Analysis" component1 $RDIR/pentest/tickets/blank.txt 
trac-admin /var/trac/$CLIENT ticket add "Create Tickets from Nessus Scan Results" "Scanning" component1 $RDIR/pentest/tickets/blank.txt
trac-admin /var/trac/$CLIENT ticket add "Create Tickets from Nikto Scan Results" "Scanning" component1 $RDIR/pentest/tickets/blank.txt
trac-admin /var/trac/$CLIENT ticket add "Create Tickets from Nmap Scan Results" "Scanning" component1 $RDIR/pentest/tickets/blank.txt

## Attack Tix
trac-admin /var/trac/$CLIENT ticket add "Bruteforce Services" "Attack" component1 $RDIR/pentest/tickets/brute_ssh.txt
trac-admin /var/trac/$CLIENT ticket add "Locate and Attack Web Applications" "Internet Application Testing" component1 $RDIR/pentest/tickets/webapps.txt

## Reporting Tix

  ## Hasn't been built yet
  ##trac-admin /var/trac/$CLIENT ticket add "Parse Tickets -> DREAD Findings" "Reporting" $RDIR/pentest/tickets/blank.txt 

trac-admin /var/trac/$CLIENT ticket add "Prepare Template Report" "Reporting" component1 $RDIR/pentest/tickets/blank.txt
trac-admin /var/trac/$CLIENT ticket add "Write Executive Summary" "Reporting" component1 $RDIR/pentest/tickets/blank.txt
trac-admin /var/trac/$CLIENT ticket add "Write Attack Summary" "Reporting" component1 $RDIR/pentest/tickets/blank.txt
trac-admin /var/trac/$CLIENT ticket add "Prepare Report Portal" "Reporting" component1 $RDIR/pentest/tickets/blank.txt
trac-admin /var/trac/$CLIENT ticket add "Prepare Supporting Documentation" "Reporting" component1 $RDIR/pentest/tickets/blank.txt

## Teardown Tix
trac-admin /var/trac/$CLIENT ticket add "Debriefing Call Scheduled" "Project Teardown" component1 $RDIR/pentest/tickets/blank.txt 
trac-admin /var/trac/$CLIENT ticket add "Debriefing Call Completed" "Project Teardown" component1 $RDIR/pentest/tickets/blank.txt 
trac-admin /var/trac/$CLIENT ticket add "Debriefing Call Scheduled" "Project Teardown" component1 $RDIR/pentest/tickets/blank.txt 


# set ticket resolution messages
# Requires Trac 0.11
## leaves invalid, and duplicate
#trac-admin /var/trac/$CLIENT resolution remove fixed
#trac-admin /var/trac/$CLIENT resolution remove wontfix
#trac-admin /var/trac/$CLIENT resolution remove worksforme
#trac-admin /var/trac/$CLIENT resolution add findingconfirmed
#trac-admin /var/trac/$CLIENT resolution add taskcompleted
#trac-admin /var/trac/$CLIENT resolution add taskskipped

# Wiki Customization
# this is for the start page for jcran..
rm  $RDIR/pentest/wiki/*
trac-admin /var/trac/TEMPLATEpentest wiki dump $RDIR/pentest/wiki/
trac-admin /var/trac/$CLIENT wiki load $RDIR/pentest/wiki

## Repo Customization (05/08/08)
#Create directories needed

mkdir -p /tmp   #should fail (already exists)
mkdir -p /tmp/$CLIENT/ #should fail (already exists)

cd /tmp/$CLIENT/
svn co file:///var/svn/$CLIENT/ svn
cd svn/trunk
svn export file:///var/svn/TEMPLATEpentest/
mv -f TEMPLATEpentest/trunk/* .
rm -Rf TEMPLATEpentest
svn add * 
svn ci -m "initial template pentest checkin" *

rm -rf /tmp/$CLIENT/
