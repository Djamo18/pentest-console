#!/bin/bash
###
#
# $RDIR/pentestCustomization.sh 
#
###
#
# Owner: 	jabra
#		jcran
#
# Purpose: 	Do Trac-specific customization for a $RDIR/pentest
#
# Description: 
#		- Add Pentest Milestones
#		- Add Pentest Tickets
#		- Set Ticket Resolutions (not implemented)
#		- Load Pentest Wiki Template
#
# History:
#		03/15/08 - Created from start_engagement.sh

#Get Arguments
CLIENT=$1
if [ $0 == "sudo" ] ; then
        CLIENT=$2
fi

#echo $CLIENT

#Sanitize Client Name
CLIENT=`echo $CLIENT |perl -p -e 's/\W//g'`

if [ -z $CLIENT  ] ; then
        echo "Client is blank"
        exit 1
fi

RDIR=/var/www/scripts

# add milestones
trac-admin /var/trac/$CLIENT milestone add "Project Setup"
trac-admin /var/trac/$CLIENT milestone add "Interviews"
trac-admin /var/trac/$CLIENT milestone add "Documentation Review"
trac-admin /var/trac/$CLIENT milestone add "Deliverable Preparation"
trac-admin /var/trac/$CLIENT milestone add "Project Teardown"


# add tickets

#trac-admin /var/trac/$CLIENT ticket add "Example Ticket" "Milestone" $RDIR/audit/tickets/blank.txt


# set ticket resolution messages
# Requires Trac 0.11
## leaves invalid, and duplicate
#trac-admin /var/trac/$CLIENT resolution remove fixed
#trac-admin /var/trac/$CLIENT resolution remove wontfix
#trac-admin /var/trac/$CLIENT resolution remove worksforme
#trac-admin /var/trac/$CLIENT resolution add vulnfound
#trac-admin /var/trac/$CLIENT resolution add novulnfound
#trac-admin /var/trac/$CLIENT resolution add taskdone
#trac-admin /var/trac/$CLIENT resolution add taskskipped

# Wiki Customization
# this is for the start page for jcran..
rm  $RDIR/audit/wiki/*
trac-admin /var/trac/TEMPLATEaudit wiki dump $RDIR/audit/wiki/
trac-admin /var/trac/$CLIENT wiki load $RDIR/audit/wiki

## Repo Customization (05/08/08)
#Create directories needed
mkdir -p /tmp   #should fail (already exists)
mkdir -p /tmp/$CLIENT/ #should fail (already exists)

cd /tmp/$CLIENT/
svn co file:///var/svn/$CLIENT/ svn
cd svn/trunk
svn export file:///var/svn/TEMPLATEaudit/
mv -f TEMPLATEaudit/trunk/* .
rm -Rf TEMPLATEaudit
svn add * 
svn ci -m "template audit checkin" *
