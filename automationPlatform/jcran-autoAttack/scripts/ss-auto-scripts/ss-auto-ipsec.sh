#!/bin/bash
## Owner: jcran
## Purpose: automate service-specific scan
## Description:
##	1) Set up service enviroment
##	2) Call individual tools from toolkit
##
## Notes: Script is run automatically from ss-auto-pentest.sh (Pentest_Scripts)
##

## Set current service we're scanning (mostly for consistency among service scripts)
export AP_CURRENT_SERVICE="IPSEC"

## Gather user options
## --------------------
if [ $# -ne 1 ]; then
	echo "Usage: $0 [hostList]"
	exit -1
fi

if [ -s "$1" ]
then
	if [ "$AP_DEBUG" -eq "1" ]
	then	
		echo "$AP_CURRENT_SERVICE HOSTS:\n"
		for i in `cat $1`; do echo "$i\n"; done
	fi
else
	echo "No $AP_CURRENT_SERVICE hosts in $1"
	exit
fi


## IKE-SCAN
## --------------------------
for i in `cat $1`
do
	echo
        echo
        echo -------------------------------------------------
	echo "$0 - ike-scanning $i"
	echo -------------------------------------------------
	echo
	echo "FINGERPRINT"
	echo ike-scan --showbackoff $i
	ike-scan --showbackoff $i

	echo "FINGERPRINT? - PSK Authentication" 
	echo ike-scan --showbackoff $i
	ike-scan --showbackoff $i --auth=1

	echo "FINGERPRINT? - Cert Authentication " 
	echo ike-scan --showbackoff $i
	ike-scan --showbackoff $i --auth=3

	echo "FINGERPRINT? - Hybrid Mode Authentication (SecureID, Tokens, etc)" 
	echo ike-scan --showbackoff $i
	ike-scan --showbackoff $i --auth=64221


	echo "AGRESSIVE MODE?" 
	echo ike-scan --aggressive $i
	ike-scan --aggressive $i

	echo "AGRESSIVE MODE? - PSK Authentication" 
	echo ike-scan --aggressive $i
	ike-scan --aggressive $i

	echo "AGRESSIVE MODE? - Cert Authentication " 
	echo ike-scan --aggressive $i
	ike-scan --aggressive $i
	
	echo "AGRESSIVE MODE? - Hybrid Mode Authentication (SecureID, Tokens, etc)" 
	echo ike-scan --aggressive $i
	ike-scan --aggressive $i

done


