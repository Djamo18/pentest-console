#!/bin/bash
## Owner: jcran
## Purpose: automate service-specific scan
## Description:
##	1) Set up service enviroment
##	2) Call individual tools from toolkit
##
## Notes: Script is run automatically from ss-auto-pentest.sh (Pentest_Scripts)
##

## Set current service we're scanning (mostly for consistency among service scripts)
export AP_CURRENT_SERVICE="HTTP"

## Let the kids @ home know where we're at in the hierarchy...
## -----------------------------------------------------------
if [ "$AP_DEBUG" -eq "1" ]
then	
	echo "CURRENT SCRIPT: $0"
fi

## Gather user options
## --------------------
if [ $# -ne 1 ]; then
	echo "Usage: $0 [hostList]"
	exit -1
fi

if [ -s "$1" ]
then
	if [ "$AP_DEBUG" -eq "1" ]
	then	
		echo "$AP_CURRENT_SERVICE HOSTS:\n"
		for i in `cat $1`; do echo "$i\n"; done
	fi
else
	echo "No $AP_CURRENT_SERVICE hosts in $1"
	exit
fi

## NIKTO
## --------------------------------------
for i in `cat $1`
do
	echo "$0 - Nikto'ing $i"
	##NOTE: Nikto needs to have been untarred here.
	## tar -zxvf $AP_TOOLKIT/nix/attack-net-webserver/nikto-current.tar.gz
	$AP_TOOLKIT/nix/attack-net-webserver/nikto/nikto.pl -host $i > $AP_RESULT_DIR/ss_auto_http_nikto_$i
	##echo "$!" >> $AP_PROJECT_NAME/backgroundJobs
done


##  WGET (Mirroring)
## -------------------------------
mkdir $AP_RESULT_DIR/http_mirror
for i in `cat $1`
do 
	cd $AP_RESULT_DIR/http_mirror
	# get the host header for this web server (assumes only one)
	#AP_CURRENT_HEADER=`host $i | cut -f 5 -d ' '`
	#echo  "wget mirroring $i"
	# wget mirror the site in the http results dir

	echo "$0 - wgett'ing HTTP://$i/"
	wget --no-check-certificate -m http://$i/
	##echo "$!" >> $AP_PROJECT_NAME/backgroundJobs 
	
	echo "wget mirroring ....  $AP_CURRENT_HEADER"
	wget -m $AP_CURRENT_HEADER 

	cd -
done

## DIRBUSTER - short list
## --------------------------




## HTTRACK
## --------------------------
