#!/bin/bash
## Owner: jcran
## Purpose: automate service-specific scan
## Description:
##	1) Set up service enviroment
##	2) Call individual tools from toolkit
##
## Notes: Script is run automatically from ss-auto-pentest.sh (Pentest_Scripts)
##

## Set current service we're scanning (mostly for consistency among service scripts)
export AP_CURRENT_SERVICE="MSRPC"

## Let the kids @ home know where we're at in the hierarchy...
## -----------------------------------------------------------
if [ "$AP_DEBUG" -eq "1" ]
then	
	echo "CURRENT SCRIPT: $0"
fi

## Gather Options
## --------------------
if [ $# -ne 1 ]; then
	echo "Usage: $0 [hostList]"
	exit -1
fi

if [ -s "$1" ]
then
	if [ "$AP_DEBUG" -eq "1" ]
	then	
		echo "$AP_CURRENT_SERVICE HOSTS:\n"
		for i in `cat $1`; do echo "$i\n"; done
	fi
else
	echo "No $AP_CURRENT_SERVICE hosts in $1"
	exit
fi


# SMBCLIENT
##---------------------------------
if [ "$AP_DEBUG" -eq "1" ]
then	
	echo "$0 - calling SMBCLIENT"
fi

for i in `cat $1`;
do
	echo "running smbclient against $i"		
	smbclient -L $i -N -U "" > $AP_RESULT_DIR/ss_cifs_smbclient_$i
done

## NMBLOOKUP
## -----------------------------
if [ "$AP_DEBUG" -eq "1" ]
then	
	echo "$0 - calling NMBLOOKUP"
fi

for i in `cat $1`;
do
	echo "running nbmlookup against $i"		
	nmblookup -A $i > $AP_RESULT_DIR/ss_cifs_nmblookup_$i
done

