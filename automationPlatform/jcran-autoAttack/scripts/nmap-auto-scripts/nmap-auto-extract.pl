#!/usr/bin/perl
## Owner: jcran
## Purpose: parse nmap results
## Description:
##
## Notes: Script is run automatically from nmap-auto-pentest.sh (Pentest_Scripts)
##
## History: 
##	03/29/08 - copied from jabra's nmap-extract (jcran)
##	03/29/08 - dumps all files into a single directory (jcran)
##	03/29/08 - modified files into RESULT directory (jcran)
## 	03/29/08 - added AP integration (jcran)
##      04/23/08 - added snmp & fixed cifs files (jcran)
##	
##
use strict;

## DEBUG
##print "perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -s cifs -f $ENV{'AP_NMAP_RESULT'} > $ENV{'AP_RESULT_DIR'}/nmap_cifs.list";

system("perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -i -f $ENV{'AP_NMAP_RESULT'} > $ENV{'AP_RESULT_DIR'}/services/nmap_all_ips.list");
system("perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -s ftp -f $ENV{'AP_NMAP_RESULT'} > $ENV{'AP_RESULT_DIR'}/services/nmap_ftp.list");
system("perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -s ftps -f $ENV{'AP_NMAP_RESULT'} > $ENV{'AP_RESULT_DIR'}/services/nmap_ftps.list");
system("perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -s ssh -f $ENV{'AP_NMAP_RESULT'} > $ENV{'AP_RESULT_DIR'}/services/nmap_ssh.list");
system("perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -s telnet -f $ENV{'AP_NMAP_RESULT'} > $ENV{'AP_RESULT_DIR'}/services/nmap_telnet.list");
system("perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -s telnets -f $ENV{'AP_NMAP_RESULT'} > $ENV{'AP_RESULT_DIR'}/services/nmap_telnets.list");
system("perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -s smtp -f $ENV{'AP_NMAP_RESULT'} > $ENV{'AP_RESULT_DIR'}/services/nmap_smtp.list");
system("perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -s domain -f $ENV{'AP_NMAP_RESULT'} > $ENV{'AP_RESULT_DIR'}/services/nmap_dns.list");
system("perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -s imap -f $ENV{'AP_NMAP_RESULT'} > $ENV{'AP_RESULT_DIR'}/services/nmap_imap.list");
system("perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -s imaps -f $ENV{'AP_NMAP_RESULT'} > $ENV{'AP_RESULT_DIR'}/services/nmap_imaps.list");
system("perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -s pop3 -f $ENV{'AP_NMAP_RESULT'} > $ENV{'AP_RESULT_DIR'}/services/nmap_pop3.list");
system("perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -s http -f $ENV{'AP_NMAP_RESULT'} > $ENV{'AP_RESULT_DIR'}/services/nmap_http.list");
system("perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -s https -f $ENV{'AP_NMAP_RESULT'} > $ENV{'AP_RESULT_DIR'}/services/nmap_https.list");
system("perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -p 500 -f $ENV{'AP_NMAP_RESULT'} > $ENV{'AP_RESULT_DIR'}/services/nmap_ipsec.list");
system("perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -p 902 -f $ENV{'AP_NMAP_RESULT'} > $ENV{'AP_RESULT_DIR'}/services/nmap_vmware.list");
system("perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -s ms-term-serv -f $ENV{'AP_NMAP_RESULT'} > $ENV{'AP_RESULT_DIR'}/services/nmap_rdesktop.list");
system("perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -s citrix-ica -f $ENV{'AP_NMAP_RESULT'} > $ENV{'AP_RESULT_DIR'}/services/nmap_citrix.list");
system("perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -s vnc -f $ENV{'AP_NMAP_RESULT'} > $ENV{'AP_RESULT_DIR'}/services/nmap_vnc.list");
system("perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -p 135 -f $ENV{'AP_NMAP_RESULT'} > $ENV{'AP_RESULT_DIR'}/services/nmap_cifs.list");
system("perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -p 139 -f $ENV{'AP_NMAP_RESULT'} >> $ENV{'AP_RESULT_DIR'}/services/nmap_cifs.list");
system("perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -p 445 -f $ENV{'AP_NMAP_RESULT'} >> $ENV{'AP_RESULT_DIR'}/services/nmap_cifs.list");
system("perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -s http-vnc -f $ENV{'AP_NMAP_RESULT'} > $ENV{'AP_RESULT_DIR'}/services/nmap_http-vnc.list");
system("perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -s portmapper -f $ENV{'AP_NMAP_RESULT'} > $ENV{'AP_RESULT_DIR'}/services/nmap_portmapper.list");
system("perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -p 161 -f $ENV{'AP_NMAP_RESULT'} > $ENV{'AP_RESULT_DIR'}/services/nmap_snmp.list");
system("perl $ENV{'AP_NMAP_SCRIPT_DIR'}/nmap-parse.pl -p 162 -f $ENV{'AP_NMAP_RESULT'} >> $ENV{'AP_RESULT_DIR'}/services/nmap_snmp.list");
